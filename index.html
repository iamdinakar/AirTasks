<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>AirTasks</title>
  <style>
    :root{
      --bg:#ffffff;
      --panel:#ffffff;
      --text:rgba(0,0,0,.92);
      --muted:rgba(0,0,0,.56);
      --hair:rgba(0,0,0,.10);
      --soft:rgba(0,0,0,.04);
      --focus:rgba(0,0,0,.22);
      --shadow: 0 18px 60px rgba(0,0,0,.08);
      --radius: 20px;
      --radius2: 14px;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b0c10;
        --panel:rgba(255,255,255,.06);
        --text:rgba(255,255,255,.92);
        --muted:rgba(255,255,255,.58);
        --hair:rgba(255,255,255,.14);
        --soft:rgba(255,255,255,.06);
        --focus:rgba(255,255,255,.22);
        --shadow: 0 22px 70px rgba(0,0,0,.55);
      }
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      letter-spacing:-0.01em;
    }

    .wrap{
      min-height:100%;
      display:flex;
      justify-content:center;
      padding: clamp(22px, 5vw, 64px);
    }

    .app{
      width:min(920px, 100%);
      display:flex;
      flex-direction:column;
      gap: 18px;
    }

    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:18px;
      padding: 2px 2px 0 2px;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    .title{
      font-weight:650;
      font-size: clamp(22px, 2.7vw, 34px);
      line-height:1.1;
    }

    .sub{
      color:var(--muted);
      font-size: 14px;
      line-height:1.35;
      max-width: 52ch;
    }

    .panel{
      background: var(--panel);
      border:1px solid var(--hair);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }

    .composer{
      padding: 18px;
      display:flex;
      gap: 12px;
      align-items:center;
      border-bottom:1px solid var(--hair);
    }

    .field{
      flex:1 1 auto;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 14px;
      border:1px solid var(--hair);
      background: transparent;
      border-radius: var(--radius2);
    }

    .field input{
      width:100%;
      border:0;
      outline:0;
      background: transparent;
      color:var(--text);
      font-size: 16px;
    }

    .btn{
      border:1px solid var(--hair);
      background: transparent;
      color:var(--text);
      border-radius: 999px;
      padding: 10px 12px;
      display:inline-flex;
      align-items:center;
      gap:10px;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
    }

    .btn:hover{ background: var(--soft); }
    .btn:active{ transform: translateY(1px); }
    .btn:focus-visible{ outline:3px solid var(--focus); outline-offset:2px; }

    .btn .label{ font-size: 14px; }

    .toolbar{
      padding: 12px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }

    .meta{
      color:var(--muted);
      font-size: 13px;
      display:flex;
      align-items:center;
      gap:10px;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }

    .ghost{
      border-color: transparent;
      background: transparent;
      color: var(--muted);
      padding: 10px 10px;
    }
    .ghost:hover{ background: var(--soft); color: var(--text); border-color: transparent; }

    ul{
      list-style:none;
      margin:0;
      padding: 6px 10px 16px 10px;
    }

    .row{
      display:flex;
      align-items:center;
      gap: 12px;
      padding: 12px 12px;
      border-radius: var(--radius2);
      margin: 4px 0;
    }

    .row:hover{ background: var(--soft); }

    .check{
      width: 22px;
      height: 22px;
      border-radius: 8px;
      border:1px solid var(--hair);
      display:grid;
      place-items:center;
      flex: 0 0 auto;
      cursor:pointer;
      user-select:none;
    }

    .check svg{ opacity:0; }

    .done .check{
      border-color: transparent;
      background: color-mix(in srgb, var(--text) 88%, transparent);
    }

    .done .check svg{ opacity:1; }

    .text{
      flex:1 1 auto;
      font-size: 16px;
      line-height: 1.35;
      word-break: break-word;
    }

    .done .text{
      color: var(--muted);
      text-decoration: line-through;
      text-decoration-thickness: 1.5px;
      text-decoration-color: color-mix(in srgb, var(--muted) 70%, transparent);
    }

    .icon{
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      border:1px solid transparent;
      background: transparent;
      color: var(--muted);
      cursor:pointer;
      flex: 0 0 auto;
    }

    .icon:hover{ background: var(--soft); color: var(--text); }
    .icon:focus-visible{ outline:3px solid var(--focus); outline-offset:2px; }

    .foot{
      padding: 0 18px 18px 18px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .foot b{ color: var(--text); font-weight: 600; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 22px;
      transform: translateX(-50%);
      background: color-mix(in srgb, var(--bg) 78%, var(--soft));
      border: 1px solid var(--hair);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: var(--shadow);
      color: var(--text);
      font-size: 13px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }

    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-2px); }

    @media (prefers-reduced-motion: reduce){
      .btn:active{ transform:none; }
      .toast{ transition:none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="app">
      <header>
        <div class="brand">
          <div class="title">AirTasks</div>
          <div class="sub">Tasks are saved on your device. You can share the list using the link.</div>
        </div>
        <button class="btn" id="shareBtn" type="button" title="Copy shareable link">
          <span class="label">Share link</span>
        </button>
      </header>

      <div class="panel" role="application" aria-label="Task list">
        <div class="composer">
          <div class="field" aria-label="Add a task">
            <input id="taskInput" autocomplete="off" placeholder="Add a task" />
          </div>
          <button class="btn" id="addBtn" type="button" title="Add task">
            <span aria-hidden="true">+</span>
            <span class="label">Add</span>
          </button>
        </div>

        <div class="toolbar">
          <div class="meta" id="stats">0 tasks</div>
          <div class="actions">
            <button class="btn ghost" id="clearDoneBtn" type="button" title="Remove completed tasks">Clear done</button>
            <button class="btn ghost" id="resetBtn" type="button" title="Remove all tasks">Reset</button>
          </div>
        </div>

        <ul id="list" aria-label="Tasks"></ul>

        <div class="foot">
          <b>Privacy:</b> nothing is sent to a server. Saved in <b>local storage</b> and in the <b>link</b> when you share.
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" aria-live="polite"></div>

  <script>
  (() => {
    "use strict";

    const LS_KEY = "airtasks:v2";
    const MAX_HASH_CHARS_SOFT = 6000; // keep links reasonable

    const $ = (id) => document.getElementById(id);
    const listEl = $("list");
    const inputEl = $("taskInput");
    const statsEl = $("stats");
    const toastEl = $("toast");

    const state = { v: 1, tasks: [] };

    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);

    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(() => toastEl.classList.remove("show"), 1400);
    }

    // base64url UTF-8 helpers
    function toBase64Url(str){
      const bytes = new TextEncoder().encode(str);
      let bin = "";
      const chunk = 0x8000;
      for (let i = 0; i < bytes.length; i += chunk){
        bin += String.fromCharCode(...bytes.subarray(i, i + chunk));
      }
      return btoa(bin).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");
    }

    function fromBase64Url(b64url){
      const b64 = b64url.replace(/-/g,"+").replace(/_/g,"/");
      const pad = b64.length % 4 ? "=".repeat(4 - (b64.length % 4)) : "";
      const bin = atob(b64 + pad);
      const bytes = new Uint8Array(bin.length);
      for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);
      return new TextDecoder().decode(bytes);
    }

    function serialize(){
      // compact payload for URL
      return JSON.stringify({
        v: 1,
        t: state.tasks.map(x => [x.id, x.text, x.done ? 1 : 0])
      });
    }

    function deserialize(jsonStr){
      const obj = JSON.parse(jsonStr);
      if (!obj || obj.v !== 1 || !Array.isArray(obj.t)) throw new Error("Bad payload");
      return obj.t.map(row => ({
        id: String(row[0] ?? uid()),
        text: String(row[1] ?? "").trim(),
        done: !!row[2]
      })).filter(x => x.text.length > 0);
    }

    function writeLocal(){
      try { localStorage.setItem(LS_KEY, serialize()); } catch {}
    }

    function writeHash(){
      const encoded = toBase64Url(serialize());
      const next = "#" + encoded;
      if (next.length > MAX_HASH_CHARS_SOFT){
        toast("Link too long. Saved on device.");
        return;
      }
      history.replaceState(null, "", next);
    }

    function persist(){
      writeLocal();
      writeHash();
      render();
    }

    function loadFromHash(){
      const raw = location.hash.slice(1).trim();
      if (!raw) return false;
      try{
        const json = fromBase64Url(raw);
        state.tasks = deserialize(json);
        writeLocal();
        return true;
      }catch{
        return false;
      }
    }

    function loadFromLocal(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return false;
        state.tasks = deserialize(raw);
        return true;
      }catch{
        return false;
      }
    }

    function init(){
      // Priority: shared link > local
      const okHash = loadFromHash();
      if (!okHash) loadFromLocal();
      render();
      inputEl.focus();
    }

    function addTask(text){
      const t = (text ?? "").trim();
      if (!t) return;
      state.tasks.unshift({ id: uid(), text: t, done: false });
      inputEl.value = "";
      persist();
    }

    function toggleTask(id){
      const t = state.tasks.find(x => x.id === id);
      if (!t) return;
      t.done = !t.done;
      persist();
    }

    function deleteTask(id){
      const i = state.tasks.findIndex(x => x.id === id);
      if (i < 0) return;
      state.tasks.splice(i, 1);
      persist();
    }

    function clearDone(){
      const before = state.tasks.length;
      state.tasks = state.tasks.filter(x => !x.done);
      const removed = before - state.tasks.length;
      persist();
      toast(removed ? `Cleared ${removed}` : "No completed tasks");
    }

    function resetAll(){
      state.tasks = [];
      persist();
      toast("Reset");
    }

    function statsText(){
      const total = state.tasks.length;
      const done = state.tasks.filter(x => x.done).length;
      const left = total - done;
      if (total === 0) return "0 tasks";
      if (done === 0) return `${total} task${total===1?"":"s"}`;
      return `${left} left · ${done} done`;
    }

    function render(){
      statsEl.textContent = statsText();
      listEl.innerHTML = "";

      if (state.tasks.length === 0){
        const li = document.createElement("li");
        li.className = "row";
        li.style.border = "1px dashed var(--hair)";
        li.style.background = "transparent";
        li.style.margin = "10px";
        li.style.padding = "16px 14px";
        li.innerHTML = `<div class="text" style="color:var(--muted)">Add a task. Use “Share link” to copy the list URL.</div>`;
        listEl.appendChild(li);
        return;
      }

      for (const t of state.tasks){
        const li = document.createElement("li");
        li.className = "row" + (t.done ? " done" : "");

        const check = document.createElement("div");
        check.className = "check";
        check.setAttribute("role","checkbox");
        check.setAttribute("tabindex","0");
        check.setAttribute("aria-checked", t.done ? "true" : "false");
        check.title = "Mark done";
        check.innerHTML = `
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M13.5 4.5L6.6 11.4L3 7.8" stroke="white" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        `;

        const txt = document.createElement("div");
        txt.className = "text";
        txt.textContent = t.text;

        const del = document.createElement("button");
        del.className = "icon";
        del.type = "button";
        del.title = "Delete";
        del.setAttribute("aria-label","Delete task");
        del.innerHTML = `
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M7 7l10 10M17 7L7 17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        `;

        check.addEventListener("click", () => toggleTask(t.id));
        check.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " "){
            e.preventDefault();
            toggleTask(t.id);
          }
        });
        del.addEventListener("click", () => deleteTask(t.id));

        li.appendChild(check);
        li.appendChild(txt);
        li.appendChild(del);
        listEl.appendChild(li);
      }
    }

    async function shareLink(){
      writeHash();
      const url = location.href;
      try{
        await navigator.clipboard.writeText(url);
        toast("Link copied");
      }catch{
        // fallback
        const ta = document.createElement("textarea");
        ta.value = url;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        toast("Link copied");
      }
    }

    // Events
    $("addBtn").addEventListener("click", () => addTask(inputEl.value));
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") addTask(inputEl.value);
    });
    $("shareBtn").addEventListener("click", shareLink);
    $("clearDoneBtn").addEventListener("click", clearDone);
    $("resetBtn").addEventListener("click", resetAll);

    window.addEventListener("hashchange", () => {
      if (loadFromHash()){
        render();
        toast("Loaded from link");
      }
    });

    init();
  })();
  </script>
</body>
</html>
